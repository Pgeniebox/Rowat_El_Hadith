<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create JSON Form</title>
<style>
  body {
    background-color: #222;
    color: #fff;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 40px;
  }

  h2 {
    color: #fff;
  }

  input[type="text"],
  select {
    background-color: #333;
    color: #fff;
    border: 1px solid #444;
    padding: 8px;
    margin-right: 10px;
  }

  input[type="text"]:focus,
  select:focus {
    outline: none;
    border-color: #555;
  }

  button {
    background-color: #163d81;
    color: #fff;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 3px;
  }

  button:hover {
    background-color: #2e4f89;
  }

  .nestedFields {
    margin-left: 20px;
  }

  .nestedFields div {
    margin-bottom: 5px;
  }

  #formFields {
    margin-top: 20px;
  }

  #formFields div {
    margin-bottom: 10px;
  }

  pre {
    background-color: #333;
    color: #fff;
    padding: 10px;
    white-space: pre-wrap;
    margin-top: 20px;
    font-size: 14px;
  }
</style>
</head>
<body>
  <h2 id="pageTitle">Créer un formulaire JSON</h2>
<div style="
    margin-bottom: 40px;
">
    <label id="fileNameLabel" for="fileName">Nom du fichier :</label>
    <input type="text" id="fileName">
    <button onclick="downloadJSON()" id="downloadBtn" disabled="" style="opacity: 0.5;">Télécharger le fichier</button>
    <button onclick="modifyJSONFile()" id="modifyBtn" disabled="" style="opacity: 0.5;">Modifier le fichier JSON</button>
    <button onclick="removeJSONFile()" id="removeBtn" disabled="" style="opacity: 0.5;">Supprimer le fichier JSON</button>
</div>
<div style="
    height: 1px;
    margin: 20px;
    width: auto;
    background-color: grey;
    opacity: 0.2;
"></div>
<div>
    <label id="keyLabel" for="inputKey">Clé :</label>
    <input type="text" id="inputKey" dir="rtl">
    <label id="valueLabel" for="inputValue">Valeur :</label>
    <input type="text" id="inputValue" dir="rtl">
    <select id="inputType" dir="rtl">
        <option value="string">Texte</option>
        <option value="number">Nombre</option>
        <option value="boolean">Booléen</option>
        <option value="array">Tableau</option>
        <option value="object">Objet</option>
    </select>
    <button onclick="addField()" id="addFieldBtn">Ajouter un champ</button>
</div>
<div style="
    height: 1px;
    margin: 20px;
    width: auto;
    background-color: grey;
    opacity: 0.2;
"></div>
<div id="formFields"></div>
<div style="
    height: 1px;
    margin: 20px;
    width: auto;
    background-color: grey;
    opacity: 0.2;
"></div>
<pre id="jsonDisplay"></pre>
<div style="
    height: 1px;
    margin: 20px;
    width: auto;
    background-color: grey;
    opacity: 0.2;
"></div>
<button onclick="changeLanguage('en')">English</button>
<button onclick="changeLanguage('ar')">العربية</button>
<button onclick="changeLanguage('fr')">Français</button>
<button onclick="configureGitHub()">Configurer GitHub</button>
<button onclick="updateJSONFile()" id="updateBtn" disabled="" style="opacity: 0.5;">Mettre à jour le fichier JSON</button>
<div style="
    position: absolute;
    bottom: 0;
">Created by Lagab Adel.</div>

<script>
    let jsonObject = {};
    let githubOwner=null;
    let githubRepo=null;
    let githubPath=null;
    let githubFileName=null;
    let githubToken=null;
    const languageTexts = {
        'en': {
            'pageTitle': 'Create JSON Form',
            'addFieldBtn': 'Add Field',
            'downloadBtn': 'Download File',
            'modifyBtn': 'Modify JSON File',
            'removeBtn': 'Remove JSON File',
            'updateBtn': 'Update JSON File',
            'keyLabel': 'Key:',
            'valueLabel': 'Value:',
            'fileNameLabel': 'File Name:',
            'stringOption': 'String',
            'numberOption': 'Number',
            'booleanOption': 'Boolean',
            'arrayOption': 'Array',
            'objectOption': 'Object'
        },
        'ar': {
            'pageTitle': 'إنشاء نموذج JSON',
            'addFieldBtn': 'إضافة حقل',
            'downloadBtn': 'تحميل الملف',
            'modifyBtn': 'تعديل ملف JSON',
            'removeBtn': 'إزالة ملف JSON',
            'updateBtn': 'تحديث ملف JSON',
            'keyLabel': 'المفتاح:',
            'valueLabel': 'القيمة:',
            'fileNameLabel': 'اسم الملف:',
            'stringOption': 'نص',
            'numberOption': 'رقم',
            'booleanOption': 'منطقي',
            'arrayOption': 'مصفوفة',
            'objectOption': 'كائن'
        },
        'fr': {
            'pageTitle': 'Créer un formulaire JSON',
            'addFieldBtn': 'Ajouter un champ',
            'downloadBtn': 'Télécharger le fichier',
            'modifyBtn': 'Modifier le fichier JSON',
            'removeBtn': 'Supprimer le fichier JSON',
            'updateBtn': 'Mettre à jour le fichier JSON',
            'keyLabel': 'Clé :',
            'valueLabel': 'Valeur :',
            'fileNameLabel': 'Nom du fichier :',
            'stringOption': 'Texte',
            'numberOption': 'Nombre',
            'booleanOption': 'Booléen',
            'arrayOption': 'Tableau',
            'objectOption': 'Objet'
        }
    };

    function removeDiacritics(text) {
        return text.normalize('NFD').replace(/[\u064B-\u0652]/g, '');
    }

    function loadConfigFromLocalStorage() {
         githubOwner = localStorage.getItem('githubOwner');
         githubRepo = localStorage.getItem('githubRepo');
         githubToken = localStorage.getItem('githubToken');

        // Check if configuration exists in localStorage
        if (githubOwner && githubRepo && githubToken) {
            // Enable the update button
            const updateBtn = document.getElementById('updateBtn');
            updateBtn.disabled = false;
            updateBtn.style.opacity = '1';
        }
    }

    // Load configuration from localStorage when the page loads
    window.onload = function() {
        loadConfigFromLocalStorage();
    };

    function configureGitHub() {
         githubOwner = prompt("Enter your GitHub repository owner:");
         githubRepo = prompt("Enter your GitHub repository name:");
         githubToken = prompt("Please enter your GitHub access token:");
        if (githubOwner && githubRepo && githubToken) {
            localStorage.setItem('githubOwner', githubOwner);
            localStorage.setItem('githubRepo', githubRepo);
            localStorage.setItem('githubToken', githubToken);

            // Enable the update button
            const updateBtn = document.getElementById('updateBtn');
            updateBtn.disabled = false;
            updateBtn.style.opacity = '1';
        }
    }

    function updateJSONFile() {
         githubOwner = localStorage.getItem('githubOwner');
         githubRepo = localStorage.getItem('githubRepo');
         githubPath = prompt("Enter the path to the file in your GitHub repository:");
         githubFileName = prompt("Enter the name of the file to update:");

        if (githubOwner && githubRepo && githubPath && githubFileName) {
             githubToken = localStorage.getItem('githubToken');
            const fileContent = JSON.stringify(jsonObject, null, 2);
            const commitMessage = prompt("Enter a commit message:");

            // Make API request to update the JSON file in the GitHub repository
            fetch(`https://api.github.com/repos/${githubOwner}/${githubRepo}/contents/${githubPath}/${githubFileName}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${githubToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: commitMessage,
                    content: btoa(fileContent) // encode content as base64
                })
            })
            .then(response => {
                if (response.ok) {
                    alert("JSON file updated successfully!");
                    // Enable modify and remove buttons after the first upload
                    document.getElementById('modifyBtn').disabled = false;
                    document.getElementById('removeBtn').disabled = false;
                } else {
                    throw new Error('Failed to update JSON file');
                }
            })
            .catch(error => {
                console.error(error);
                alert("Failed to update JSON file. Please try again.");
            });
        }
    }

 function modifyJSONFile() {
    
    if (githubOwner && githubRepo && githubPath && githubFileName) {
        // Proceed with modification logic
        const newContent = prompt("Enter the new content for the file:");
        if (newContent !== null) {
             githubToken = localStorage.getItem('githubToken');
            const commitMessage = prompt("Enter a commit message for the modification:");

            // Make API request to update the JSON file in the GitHub repository
            fetch(`https://api.github.com/repos/${githubOwner}/${githubRepo}/contents/${githubPath}/${githubFileName}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${githubToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: commitMessage,
                    content: btoa(newContent) // encode content as base64
                })
            })
            .then(response => {
                if (response.ok) {
                    alert("JSON file modified successfully!");
                } else {
                    throw new Error('Failed to modify JSON file');
                }
            })
            .catch(error => {
                console.error(error);
                alert("Failed to modify JSON file. Please try again.");
            });
        }
    } else {
        alert("GitHub configuration is missing. Please configure GitHub first.");
    }
}

function removeJSONFile() {

    if (githubOwner && githubRepo && githubPath && githubFileName) {
         githubToken = localStorage.getItem('githubToken');
        const commitMessage = prompt("Enter a commit message for the removal:");

        // Make API request to delete the JSON file from the GitHub repository
        fetch(`https://api.github.com/repos/${githubOwner}/${githubRepo}/contents/${githubPath}/${githubFileName}`, {
            method: 'DELETE',
            headers: {
                'Authorization': `token ${githubToken}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                message: commitMessage
            })
        })
        .then(response => {
            if (response.ok) {
                alert("JSON file removed successfully!");
            } else {
                throw new Error('Failed to remove JSON file');
            }
        })
        .catch(error => {
            console.error(error);
            alert("Failed to remove JSON file. Please try again.");
        });
    } else {
        alert("GitHub configuration is missing. Please configure GitHub first.");
    }
}


    var contentElement = document.getElementById('jsonDisplay');
    var myButton = document.getElementById('downloadBtn');

    // Function to enable/disable button based on content
    function checkContent() {
        if (contentElement.textContent.trim().length > 0) {
            myButton.disabled = false;
            myButton.style.opacity = '1';
        } else {
            myButton.disabled = true;
            myButton.style.opacity = '0.5';
        }
    }

    // Initial check
    checkContent();

    // Create a MutationObserver to watch for changes in the contentElement
    const observer = new MutationObserver(checkContent);

    // Configure the observer to watch for changes in the text content
    const config = { childList: true };

    // Start observing the contentElement
    observer.observe(contentElement, config);
  function addField() {
    const key = removeDiacritics(document.getElementById("inputKey").value);
    const value = removeDiacritics(document.getElementById("inputValue").value);
    const type = document.getElementById("inputType").value;

    let fieldValue;
    switch (type) {
        case "number":
            fieldValue = parseFloat(value);
            break;
        case "boolean":
            fieldValue = value === "true";
            break;
        case "array":
            fieldValue = JSON.parse(value);
            break;
        case "object":
            fieldValue = {};
            break;
        default:
            fieldValue = value;
    }

    if (jsonObject[key] && typeof jsonObject[key] === 'object') {
        const nestedKey = removeDiacritics(prompt('Enter nested key:', ''));
        const nestedValue = removeDiacritics(prompt('Enter nested value:', ''));
        fieldValue[nestedKey] = nestedValue;
    }

    jsonObject[key] = fieldValue;

    renderForm();
    displayJSON();
}
function renderForm() {
        const formFields = document.getElementById("formFields");
        formFields.innerHTML = "";

        Object.keys(jsonObject).forEach(key => {
            const fieldDiv = document.createElement("div");
            fieldDiv.textContent = `${key}:`;

            if (typeof jsonObject[key] === 'object') {
                const nestedFieldsDiv = document.createElement("div");
                nestedFieldsDiv.className = "nestedFields";

                Object.keys(jsonObject[key]).forEach(nestedKey => {
                    const nestedFieldDiv = document.createElement("div");
                    nestedFieldDiv.textContent = `${nestedKey}: ${jsonObject[key][nestedKey]}`;
                    nestedFieldsDiv.appendChild(nestedFieldDiv);
                });

                fieldDiv.appendChild(nestedFieldsDiv);
            } else {
                fieldDiv.textContent += ` ${JSON.stringify(jsonObject[key])}`;
            }

            formFields.appendChild(fieldDiv);
        });
    }

    function displayJSON() {
        document.getElementById("jsonDisplay").textContent = JSON.stringify(jsonObject, null, 2);
    }

    function changeLanguage(lang) {
        const htmlElement = document.documentElement;
        htmlElement.lang = lang;

        const texts = languageTexts[lang];
        Object.keys(texts).forEach(key => {
            const element = document.getElementById(key);
            if (element) {
                element.textContent = texts[key];
            }
        });

        // Update select options
        const selectElement = document.getElementById("inputType");
        selectElement.innerHTML = '';
        const options = ['string', 'number', 'boolean', 'array', 'object'];
        options.forEach(option => {
            const optionElement = document.createElement("option");
            optionElement.value = option;
            optionElement.textContent = texts[option + 'Option'];
            selectElement.appendChild(optionElement);
        });
    }
</script>

</body>
</html>
